SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';
USE `lynxc` ;
CREATE TABLE IF NOT EXISTS `lynxc`.`role` ( `id` INT NOT NULL AUTO_INCREMENT, PRIMARY KEY (`id`)) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`group` ( `id` INT NOT NULL AUTO_INCREMENT, `name` VARCHAR(45) NOT NULL, PRIMARY KEY (`id`), UNIQUE INDEX `name_UNIQUE` (`name` ASC)) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`language` ( `id` INT NOT NULL AUTO_INCREMENT, `name` VARCHAR(255) NOT NULL, `code` VARCHAR(2) NOT NULL, PRIMARY KEY (`id`), UNIQUE INDEX `name_UNIQUE` (`name` ASC), UNIQUE INDEX `code_UNIQUE` (`code` ASC)) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`country` ( `id` INT NOT NULL AUTO_INCREMENT, `default_language_id` INT NOT NULL, PRIMARY KEY (`id`), INDEX `fk_country_language1_idx` (`default_language_id` ASC), CONSTRAINT `fk_country_language1` FOREIGN KEY (`default_language_id`) REFERENCES `lynxc`.`language` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB COMMENT = 'The country the user lives in.';
CREATE TABLE IF NOT EXISTS `lynxc`.`user` ( `id` INT NOT NULL AUTO_INCREMENT, `firstname` VARCHAR(45) NOT NULL, `lastname` VARCHAR(45) NOT NULL, `email` VARCHAR(45) NOT NULL, `telephone` VARCHAR(45) NULL, `pwd_hash` VARCHAR(70) NULL, `role_id` INT NULL, `group_id` INT NULL, `enabled` TINYINT(1) NOT NULL DEFAULT 0, `preferred_language_id` INT NULL, `country_id` INT NULL, `activation_code` VARCHAR(45) NULL, PRIMARY KEY (`id`), INDEX `fk_user_role1_idx` (`role_id` ASC), INDEX `fk_user_group1_idx` (`group_id` ASC), INDEX `fk_user_language1_idx` (`preferred_language_id` ASC), INDEX `fk_user_country1_idx` (`country_id` ASC), UNIQUE INDEX `email_UNIQUE` (`email` ASC), CONSTRAINT `fk_user_role1` FOREIGN KEY (`role_id`) REFERENCES `lynxc`.`role` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_user_group1` FOREIGN KEY (`group_id`) REFERENCES `lynxc`.`group` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_user_language1` FOREIGN KEY (`preferred_language_id`) REFERENCES `lynxc`.`language` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_user_country1` FOREIGN KEY (`country_id`) REFERENCES `lynxc`.`country` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB COMMENT = 'A user to a content.';
CREATE TABLE IF NOT EXISTS `lynxc`.`content_def` ( `id` INT NOT NULL AUTO_INCREMENT, PRIMARY KEY (`id`)) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`section_def` ( `id` INT NOT NULL AUTO_INCREMENT, `dynamic` TINYINT(1) NOT NULL DEFAULT 0, `content_def_id` INT NOT NULL, `parent_section_def_id` INT NULL, PRIMARY KEY (`id`), INDEX `fk_section_def_content_def1_idx` (`content_def_id` ASC), INDEX `fk_section_def_section_def1_idx` (`parent_section_def_id` ASC), CONSTRAINT `fk_section_def_content_def1` FOREIGN KEY (`content_def_id`) REFERENCES `lynxc`.`content_def` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_section_def_section_def1` FOREIGN KEY (`parent_section_def_id`) REFERENCES `lynxc`.`section_def` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`content` ( `id` INT NOT NULL AUTO_INCREMENT, `content_def_id` INT NOT NULL, `updated` TIMESTAMP NULL ON UPDATE CURRENT_TIMESTAMP, `created` DATETIME NOT NULL, `version` INT NOT NULL DEFAULT 1, `locked_by` INT NULL, PRIMARY KEY (`id`), INDEX `fk_content_content_def1_idx` (`content_def_id` ASC), INDEX `fk_content_user1_idx` (`locked_by` ASC), CONSTRAINT `fk_content_content_def1` FOREIGN KEY (`content_def_id`) REFERENCES `lynxc`.`content_def` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_content_user1` FOREIGN KEY (`locked_by`) REFERENCES `lynxc`.`user` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`content_user` ( `id` INT NOT NULL AUTO_INCREMENT, `content_id` INT NOT NULL, `user_id` INT NOT NULL, `can_read` TINYINT(1) NOT NULL DEFAULT 1, `can_write` TINYINT(1) NOT NULL DEFAULT 0, `last_read` TIMESTAMP NULL, `last_write` TIMESTAMP NULL, INDEX `fk_content_user_content1_idx` (`content_id` ASC), INDEX `fk_content_user_user1_idx` (`user_id` ASC), PRIMARY KEY (`id`), CONSTRAINT `fk_content_user_content1` FOREIGN KEY (`content_id`) REFERENCES `lynxc`.`content` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_content_user_user1` FOREIGN KEY (`user_id`) REFERENCES `lynxc`.`user` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB COMMENT = 'The information for a user of a specific content.';
CREATE TABLE IF NOT EXISTS `lynxc`.`item_type` ( `id` INT NOT NULL AUTO_INCREMENT, `value` VARCHAR(45) NOT NULL, PRIMARY KEY (`id`), UNIQUE INDEX `value_UNIQUE` (`value` ASC)) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`resource_layout` ( `id` INT NOT NULL AUTO_INCREMENT, `value` VARCHAR(45) NOT NULL, PRIMARY KEY (`id`), UNIQUE INDEX `value_UNIQUE` (`value` ASC)) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`item_def` ( `id` INT NOT NULL AUTO_INCREMENT, `section_def_id` INT NOT NULL, `item_type_id` INT NOT NULL, `required` TINYINT(1) NOT NULL DEFAULT 0, `regex` VARCHAR(300) NULL, `min` VARCHAR(100) NULL, `max` VARCHAR(100) NULL,`resource_layout_id` INT NULL, PRIMARY KEY (`id`), INDEX `fk_item_def_section_def1_idx` (`section_def_id` ASC), INDEX `fk_item_def_item_type1_idx` (`item_type_id` ASC), INDEX `fk_item_def_resource_layout1_idx` (`resource_layout_id` ASC), CONSTRAINT `fk_item_def_section_def1` FOREIGN KEY (`section_def_id`) REFERENCES `lynxc`.`section_def` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_item_def_item_type1` FOREIGN KEY (`item_type_id`) REFERENCES `lynxc`.`item_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_item_def_resource_layout1` FOREIGN KEY (`resource_layout_id`) REFERENCES `lynxc`.`resource_layout` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`option_def` ( `id` INT NOT NULL AUTO_INCREMENT, `item_def_id` INT NOT NULL, PRIMARY KEY (`id`), INDEX `fk_item_option_def_item_def1_idx` (`item_def_id` ASC), CONSTRAINT `fk_item_option_def_item_def1` FOREIGN KEY (`item_def_id`) REFERENCES `lynxc`.`item_def` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`section` ( `id` INT NOT NULL AUTO_INCREMENT, `section_def_id` INT NOT NULL, `content_id` INT NOT NULL, PRIMARY KEY (`id`), INDEX `fk_section_section_def1_idx` (`section_def_id` ASC), INDEX `fk_section_content1_idx` (`content_id` ASC), CONSTRAINT `fk_section_section_def1` FOREIGN KEY (`section_def_id`) REFERENCES `lynxc`.`section_def` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_section_content1` FOREIGN KEY (`content_id`) REFERENCES `lynxc`.`content` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`item` ( `id` INT NOT NULL AUTO_INCREMENT, `item_def_id` INT NOT NULL, `section_id` INT NOT NULL, PRIMARY KEY (`id`), INDEX `fk_item_item_def1_idx` (`item_def_id` ASC), INDEX `fk_item_section1_idx` (`section_id` ASC), CONSTRAINT `fk_item_item_def1` FOREIGN KEY (`item_def_id`) REFERENCES `lynxc`.`item_def` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_item_section1` FOREIGN KEY (`section_id`) REFERENCES `lynxc`.`section` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`option` ( `id` INT NOT NULL AUTO_INCREMENT, `value` VARCHAR(150) NOT NULL, `option_def_id` INT NOT NULL, `item_id` INT NOT NULL, PRIMARY KEY (`id`), INDEX `fk_option_option_def1_idx` (`option_def_id` ASC), INDEX `fk_option_item1_idx` (`item_id` ASC), CONSTRAINT `fk_option_option_def1` FOREIGN KEY (`option_def_id`) REFERENCES `lynxc`.`option_def` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_option_item1` FOREIGN KEY (`item_id`) REFERENCES `lynxc`.`item` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`role_lang` ( `id` INT NOT NULL AUTO_INCREMENT, `name` VARCHAR(45) NOT NULL, `description` TEXT NULL, `role_id` INT NOT NULL, `language_id` INT NOT NULL, PRIMARY KEY (`id`), INDEX `fk_role_lang_role1_idx` (`role_id` ASC), INDEX `fk_role_lang_language1_idx` (`language_id` ASC), CONSTRAINT `fk_role_lang_role1` FOREIGN KEY (`role_id`) REFERENCES `lynxc`.`role` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_role_lang_language1` FOREIGN KEY (`language_id`) REFERENCES `lynxc`.`language` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`item_def_lang` ( `id` INT NOT NULL AUTO_INCREMENT, `name` VARCHAR(45) NOT NULL, `description` TEXT NULL, `question` VARCHAR(300) NULL, `regex` VARCHAR(300) NULL, `max` VARCHAR(100) NULL, `min` VARCHAR(100) NULL, `language_id` INT NOT NULL, `item_def_id` INT NOT NULL, PRIMARY KEY (`id`), INDEX `fk_item_def_lang_language1_idx` (`language_id` ASC), INDEX `fk_item_def_lang_item_def1_idx` (`item_def_id` ASC), CONSTRAINT `fk_item_def_lang_language1` FOREIGN KEY (`language_id`) REFERENCES `lynxc`.`language` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_item_def_lang_item_def1` FOREIGN KEY (`item_def_id`) REFERENCES `lynxc`.`item_def` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`option_def_lang` ( `id` INT NOT NULL AUTO_INCREMENT, `name` VARCHAR(45) NULL, `description` TEXT NULL, `language_id` INT NOT NULL, `option_def_id` INT NOT NULL, PRIMARY KEY (`id`), INDEX `fk_option_def_lang_language1_idx` (`language_id` ASC), INDEX `fk_option_def_lang_option_def1_idx` (`option_def_id` ASC), CONSTRAINT `fk_option_def_lang_language1` FOREIGN KEY (`language_id`) REFERENCES `lynxc`.`language` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_option_def_lang_option_def1` FOREIGN KEY (`option_def_id`) REFERENCES `lynxc`.`option_def` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`section_def_lang` ( `id` INT NOT NULL AUTO_INCREMENT, `name` VARCHAR(45) NULL, `description` TEXT NULL, `section_def_id` INT NOT NULL, `language_id` INT NOT NULL, PRIMARY KEY (`id`), INDEX `fk_section_def_lang_section_def1_idx` (`section_def_id` ASC), INDEX `fk_section_def_lang_language1_idx` (`language_id` ASC), CONSTRAINT `fk_section_def_lang_section_def1` FOREIGN KEY (`section_def_id`) REFERENCES `lynxc`.`section_def` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_section_def_lang_language1` FOREIGN KEY (`language_id`) REFERENCES `lynxc`.`language` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`content_def_lang` ( `id` INT NOT NULL AUTO_INCREMENT, `name` VARCHAR(45) NULL, `description` TEXT NULL, `content_def_id` INT NOT NULL, `language_id` INT NOT NULL, PRIMARY KEY (`id`), INDEX `fk_content_def_lang_content_def1_idx` (`content_def_id` ASC), INDEX `fk_content_def_lang_language1_idx` (`language_id` ASC), CONSTRAINT `fk_content_def_lang_content_def1` FOREIGN KEY (`content_def_id`) REFERENCES `lynxc`.`content_def` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_content_def_lang_language1` FOREIGN KEY (`language_id`) REFERENCES `lynxc`.`language` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`country_lang` ( `id` INT NOT NULL AUTO_INCREMENT, `name` VARCHAR(45) NOT NULL, `country_id` INT NOT NULL, `language_id` INT NOT NULL, PRIMARY KEY (`id`), UNIQUE INDEX `name_UNIQUE` (`name` ASC), INDEX `fk_country_lang_country1_idx` (`country_id` ASC), INDEX `fk_country_lang_language1_idx` (`language_id` ASC), CONSTRAINT `fk_country_lang_country1` FOREIGN KEY (`country_id`) REFERENCES `lynxc`.`country` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_country_lang_language1` FOREIGN KEY (`language_id`) REFERENCES `lynxc`.`language` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB COMMENT = 'The name of the country in a specific language.';
CREATE TABLE IF NOT EXISTS `lynxc`.`content_lang` ( `id` INT NOT NULL AUTO_INCREMENT, `name` VARCHAR(200) NOT NULL, `description` TEXT NULL, `content_id` INT NOT NULL, `language_id` INT NOT NULL, PRIMARY KEY (`id`), INDEX `fk_content_lang_content1_idx` (`content_id` ASC), INDEX `fk_content_lang_language1_idx` (`language_id` ASC), CONSTRAINT `fk_content_lang_content1` FOREIGN KEY (`content_id`) REFERENCES `lynxc`.`content` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_content_lang_language1` FOREIGN KEY (`language_id`) REFERENCES `lynxc`.`language` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`email_template` ( `id` INT NOT NULL AUTO_INCREMENT, `name` VARCHAR(45) NOT NULL, `description` TEXT NULL, `subject` VARCHAR(250) NOT NULL, `body` TEXT NOT NULL, PRIMARY KEY (`id`), UNIQUE INDEX `name_UNIQUE` (`name` ASC)) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`configuration` ( `id` INT NOT NULL AUTO_INCREMENT, `key` VARCHAR(45) NOT NULL, `value` VARCHAR(300) NOT NULL, PRIMARY KEY (`id`), UNIQUE INDEX `key_UNIQUE` (`key` ASC)) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`content_admin` ( `id` INT NOT NULL AUTO_INCREMENT, `user_id` INT NOT NULL, `content_def_id` INT NOT NULL, PRIMARY KEY (`id`), INDEX `fk_content_admin_user1_idx` (`user_id` ASC), INDEX `fk_content_admin_content_def1_idx` (`content_def_id` ASC), CONSTRAINT `fk_content_admin_user1` FOREIGN KEY (`user_id`) REFERENCES `lynxc`.`user` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_content_admin_content_def1` FOREIGN KEY (`content_def_id`) REFERENCES `lynxc`.`content_def` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`resource_type` ( `id` INT NOT NULL AUTO_INCREMENT, `value` VARCHAR(45) NOT NULL, `icon_path` VARCHAR(250) NULL, PRIMARY KEY (`id`), UNIQUE INDEX `value_UNIQUE` (`value` ASC)) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`resource` ( `id` INT NOT NULL AUTO_INCREMENT, `resource_type_id` INT NOT NULL, `resource_path` VARCHAR(250) NOT NULL, `link` VARCHAR(250) NULL, `item_def_id` INT NOT NULL, PRIMARY KEY (`id`), INDEX `fk_resource_resource_type1_idx` (`resource_type_id` ASC), INDEX `fk_resource_item_def1_idx` (`item_def_id` ASC), CONSTRAINT `fk_resource_resource_type1` FOREIGN KEY (`resource_type_id`) REFERENCES `lynxc`.`resource_type` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_resource_item_def1` FOREIGN KEY (`item_def_id`) REFERENCES `lynxc`.`item_def` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
CREATE TABLE IF NOT EXISTS `lynxc`.`resource_lang` ( `id` INT NOT NULL AUTO_INCREMENT, `name` VARCHAR(45) NOT NULL, `description` TEXT NULL, `resource_id` INT NOT NULL, `language_id` INT NOT NULL, PRIMARY KEY (`id`), INDEX `fk_resource_lang_resource1_idx` (`resource_id` ASC), INDEX `fk_resource_lang_language1_idx` (`language_id` ASC), CONSTRAINT `fk_resource_lang_resource1` FOREIGN KEY (`resource_id`) REFERENCES `lynxc`.`resource` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION, CONSTRAINT `fk_resource_lang_language1` FOREIGN KEY (`language_id`) REFERENCES `lynxc`.`language` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION) ENGINE = InnoDB;
SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
